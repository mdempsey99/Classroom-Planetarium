<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student VR View</title>

<script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
<script src="https://unpkg.com/aframe-stereo-component/dist/aframe-stereo-component.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: #000;
}
</style>
</head>

<body>

<a-scene embedded device-orientation-permission-ui="enabled: true">

    <!-- Camera -->
    <a-entity camera look-controls position="0 1.6 0"></a-entity>

    <!-- Left Eye -->
    <a-entity
        id="leftSky"
        geometry="primitive: sphere; radius: 5000"
        material="side: back; src: summer_solstice.png"
        scale="-1 1 1"
        stereo="eye:left">
    </a-entity>

    <!-- Right Eye -->
    <a-entity
        id="rightSky"
        geometry="primitive: sphere; radius: 5000"
        material="side: back; src: summer_solstice.png"
        scale="-1 1 1"
        stereo="eye:right">
    </a-entity>

</a-scene>

<script>

const firebaseConfig = {
    apiKey: "AIzaSyBUXUHdJ3oox3YSixJfoYuyRRrILe6n7ck",
    authDomain: "classroom-vrplanetarium.firebaseapp.com",
    databaseURL: "https://classroom-vrplanetarium-default-rtdb.firebaseio.com",
    projectId: "classroom-vrplanetarium",
    storageBucket: "classroom-vrplanetarium.firebasestorage.app",
    messagingSenderId: "613751774262",
    appId: "1:613751774262:web:79563f3843ef894e05cc97"
};

const IMAGES = {
    summer: { normal: "summer_solstice.png", const: "summer_solstice_constellations.png" },
    winter: { normal: "winter_solstice.png", const: "winter_solstice_constellations.png" },
    spring: { normal: "spring_equinox.png", const: "spring_equinox_constellations.png" },
    fall: { normal: "fall_equinox.png", const: "fall_equinox_constellations.png" }
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Listen for teacher changes
db.ref('classroom/currentView').on('value', snap => {
    const state = snap.val();
    if (state) {
        const img = state.constellations
            ? IMAGES[state.season].const
            : IMAGES[state.season].normal;

        document.getElementById('leftSky')
            .setAttribute('material', 'src', img);

        document.getElementById('rightSky')
            .setAttribute('material', 'src', img);

        console.log('Updated:', img);
    }
});

</script>

</body>
</html>
